<%- include("../partials/header") %>
<%- include("../partials/sidebar") %>

<div class="content" id="content">
  <h1>User Experiences</h1>

  <a class="btn-add" href="/admin/experiences/add" id="addExperienceBtn">+ Add Experience</a>

<div class="experiences-container">
  <% experiences?.forEach((exp, index) => { %>
    <div class="experience-item">
      <div class="experience-header">
        <h3><%= exp.position %> at <%= exp.companyName %></h3>
        <div>
          <a class="btn-edit" href="/admin/experience/edit/<%=exp.id%>">Edit</a>
       <a href="#" 
   class="btn-delete" 
   onclick="if(confirm('Are you sure you want to delete this experience?')) { 
              fetch('/admin/experience/delete/<%= exp.id %>', { method: 'POST' })
                .then(() => location.reload())
                .catch(err => alert('Error deleting experience'));
            } 
            return false;">
   Delete
</a>

        </div>
      </div>
      <p class="experience-duration">
        <% 
          const start = new Date(exp.startDate);
          const end = exp.endDate ? new Date(exp.endDate) : null;

          const options = { year: 'numeric', month: 'long' };
          const startFormatted = !isNaN(start) ? start.toLocaleDateString('en-US', options) : '';
          const endFormatted = end && !isNaN(end) ? end.toLocaleDateString('en-US', options) : 'Present';
        %>
        <%= startFormatted %> - <%= endFormatted %>
      </p>
      <p class="experience-description"><%= exp.description %></p>
    </div>
  <% }) %>
</div>


<% if (success) { %>
<script>
  iziToast.success({
    title: 'Success',
    message: <%- JSON.stringify(success) %>,
    timeout: 5000,

    // CUSTOM SIZE
    maxWidth: 500,       // increase width (default ~350px)
    titleSize: '24px',   // bigger title font
    messageSize: '18px', // bigger message font
    padding: 30,         // more padding inside toast
    balloon: true,       // optional: makes it more prominent
  });
</script>
<% } %>

<% if (error) { %>
<script>
  iziToast.error({
    title: 'Error',
    message: <%- JSON.stringify(error) %>,
    timeout: 5000,

    // CUSTOM SIZE
    maxWidth: 500,       // increase width (default ~350px)
    titleSize: '24px',   // bigger title font
    messageSize: '18px', // bigger message font
    padding: 30,         // more padding inside toast
    balloon: true,       // optional: makes it more prominent
  });
</script>
<% } %>


<%- include("../partials/footer") %>