<%- include("../partials/header") %>
<%- include("../partials/sidebar") %>

<div class="content" id="content">
  <h1>Edit Experience</h1>

  <form action="/admin/experience/update/<%= experience.id %>" method="POST">
    
    <div class="form-group">
      <label>Company Name</label>
      <input
        type="text"
        name="companyName"
        value="<%= experience.companyName %>"
        required
      >
    </div>

    <div class="form-group">
      <label>Position</label>
      <input
        type="text"
        name="position"
        value="<%= experience.position %>"
        required
      >
    </div>

    <div class="form-group">
      <label>Description</label>
      <textarea name="description" rows="4"><%= experience.description %></textarea>
    </div>

    <%
    const formatDateInput = (date) => {
        if (!date) return '';
        const d = new Date(date);
        // Adjust for timezone offset to avoid shift
        d.setMinutes(d.getMinutes() - d.getTimezoneOffset());
        return d.toISOString().split('T')[0];
    };

    const startDate = formatDateInput(experience.startDate);
    const endDate = formatDateInput(experience.endDate);
    %>

    <div class="form-group">
    <label>Start Date</label>
    <input
        type="date"
        name="startDate"
        value="<%= startDate %>"
        required
    >
    </div>

    <div class="form-group">
    <label>End Date</label>
    <input
        type="date"
        name="endDate"
        value="<%= endDate %>"
    >
    </div>


    <button type="submit" class="btn-edit">Save Changes</button>
  </form>

  <form
    action="/admin/experience/delete/<%= experience.id %>"
    method="POST"
    style="margin-top: 1rem;"
  >
    <button type="submit" class="btn-delete">Delete Experience</button>
  </form>
</div>

<% if (success) { %>
<script>
  iziToast.success({
    title: 'Success',
    message: <%- JSON.stringify(success) %>,
    timeout: 5000,

    // CUSTOM SIZE
    maxWidth: 500,       // increase width (default ~350px)
    titleSize: '24px',   // bigger title font
    messageSize: '18px', // bigger message font
    padding: 30,         // more padding inside toast
    balloon: true,       // optional: makes it more prominent
  });
</script>
<% } %>

<% if (error) { %>
<script>
  iziToast.error({
    title: 'Error',
    message: <%- JSON.stringify(error) %>,
    timeout: 5000,

    // CUSTOM SIZE
    maxWidth: 500,       // increase width (default ~350px)
    titleSize: '24px',   // bigger title font
    messageSize: '18px', // bigger message font
    padding: 30,         // more padding inside toast
    balloon: true,       // optional: makes it more prominent
  });
</script>
<% } %>


<%- include("../partials/footer") %>
